# 数据链路层
两台相邻计算机进行帧通信的一些算法
数据链路层要完成的功能
- 向网络层提供一个定义好的接口
- 处理传输错误
- 调节数据流 确保慢速方不会被快速方淹没

链路层的工作 从网络层获得数据包 将数据包封装成帧以便传输 为每个帧包含一个帧头一个有效载荷和一个帧尾
另外还有错误控制和流量控制
## 提供给网络层的服务
一般向上层提供三种服务
- 无确认的无连接服务
- 有确认的无连接服务
- 有确认的有连接服务
### 无确认的无连接
源机器向目标机器发送独立的帧 不需确认
适合 1 错误率很低的场合 2 事实通信(时效性更重要)
### 有确认的无连接
仍然没有逻辑连接 但是每一帧都需要单独确认
适用于不可靠的信道 比如无线系统 802.11
(没收到再发一次
数据链路层提供确认只是一种优化手段 如果传输物理介质不稳定 在链路层级别进行确认并重传可以减少不必要的开销

### 有连接服务
- 传输任何数据之前都要建立一个连接
- 连接上发送的每一帧都要有编号
- 保证每个帧都按正确的顺序接收 且只接受一次
适用于长距离且不可靠的链路如
卫星信道和长途电话电路
数据传输三个阶段
- 建立连接 双方初始化各种变量和计数器
- 传输数据帧
- 连接被释放

## 成帧
将比特流拆成多个离散的帧 为每个帧计算一个称为校验和的短令牌 并将该校验和放在帧中一起传输 帧到达目标机器时 重新计算该帧的校验和 比较 若有不同->错误

### 拆分比特流
要求 好的设计方案必须使接收方很容易发现一个新帧的开始 同时使用的信道带宽要少
方法
- 字节计数法
- 字节填充的标志字节法
- 比特填充的标志比特法
- 物理层编码违禁法

#### 字节计数法
每一块字节的第一个字节表示该字节的长度
这种方法 一旦标志字节出现错误 无法纠错 甚至无法重传

#### 字节填充的标志字节法
解决了出错后的重新同步问题
使用标志字节flag标志帧的开始和结束
如果丢失同步 只要向后搜索两个相邻的flag即可
但是如果标志字节出现在数据中时 会造成问题 
通过给数据中出现的标志字节和转义字节都加入转义字符区分
在到达另一端网络层之前删除转义字节
该技术称为字节填充

#### 比特填充的标志比特法
帧的划分可以在比特级完成 不一定包含整字节 而是任意大小单元
用于HDLC(高级数据链路控制)
标志比特是01111110（0x7E）
传输数据中遇到连续的5个1 就在后面加个0
接收端遇到连续5个1后面加个0 就自动去掉那个0
USB（通用串行总线）使用了这种方法

采用比特填充和字节填充的副作用是 一帧的长度取决于发送数据的内容

#### 物理层编码违禁法
由于物理层编码时候的4B/5B等编码模式会导致有一半的编码是违法的 所以可以使用这些违法编码来区分帧的边界
许多数据链路协议综合使用这些方法

## 差错控制
用于可靠的面向连接的服务
假设接收方可以知道它是否接收到了正确的数据
一种常用方法是要求接收方发回一些特殊的控制帧 对于它所接收到的帧进行肯定或否定的确认 若否定则重传
但更复杂的是可能由于硬件问题一个帧完全丢失了 接收方没有任何反应
类似 如果确认帧丢失 发送方也不会有任何反应

这种问题通过在数据链路层引入计时器解决 发送方发出一帧时 通常同时启用一个计时器 计时器的超时值设置为足够长 以保证正常情况下该帧可以到达接收方 接收方处理后再确认返回发送方 确认帧正确接收后 计时器被取消
如果计时器超时 认为存在潜在问题 这时重传帧 同时分配序号 以免原始帧和重传帧都传递给网络层

## 流量控制
- 基于反馈的流量控制
给发送方返回信息 允许它发送更多的信息 或至少告诉发送方自己的情况
- 基于速率的流量控制
内置机制限制发送方传输数据的速率 无需利用接收方反馈信息

基于速率的仅出现在传输层
基于反馈的可以出现在链路层和更高的层次
由于网卡性能的提升 过载不再是链路层的问题
协议一般是 可以现在发多少帧 发完之后不告诉就不要再发

