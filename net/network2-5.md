# 公共电话网络
端局(本地中心局)
电话局与端局之间的双线连接:本地回路
连接外地电话:长途局,途经 长途连接中继线
以前是由逐级向上的路由进行的
AT&T解体后变为非层次路由
如今整个电话系统除了本地回路都是模拟的
## 电话政治化
美国政府将贝尔拆成一个长话公司和一群市话公司（BOC）
**由于新的政治情况产生了新的特性 导致了一种新的技术的产生**
- 新的政治情况：反垄断导致电话业务分为市话业务和长话公司
市话:164个本地接入和传输区域（LATA）每个LATA内部有一个本地交换运营商（LEC），垄断该区域中的传统电话服务
新特性：所有LATA之间的流量由跨区运营商（IXC）处理【IXC Verizon Sprint】
- 要求：任何一个IXC如果愿意处理来自一个LATA的呼叫 即可建立一个存点（POP）LEC负责将IXC连到端局（直接的客户以直接连到端局 非直接的可以连到LATA中的内部汇接局）
由于政治上要求对所有IXC都必须一视同仁 所以LATA中的用户可以选择任何一个IXC呼叫
法令禁止IXC和LEC互相涉足对方业务 
但其它业务不受限制
然而技术发展 出现了有线电视和移动电话 LEC和IXC都开始购买和兼并有线电视和移动电话运营商

1995年国会批准各个运营商（有线电视 本地电话 长途电话 无线电话）进入彼此领域
另外法案决定本地号码具有可携带性：一个用户可以不换号就改成另一个电话公司-》竞争加剧

## 本地回路
本地回路传输模拟信息已经有100多年历史（美国） 转换成数字系统有高成本 所以可能在接下来的很长时间内发挥作用

三种基本本地回路
- 调制解调器
- ADSL
- 光纤到户
### 调制解调器
要在本地物理信道上发送比特 要把比特转化为可在信道上传播的模拟信号
执行比特流和模拟信号流转换的就是调制解调器
但受制于物理规律
电话调制解调器的数据传输速率比以太网和802.11少了4个量级
如果两端都是本地回路 两端都会引入噪声 所以最大超不过33.6kbps（香农极限35kbps）
如果一端本地回路可以去掉 就可以将最大速率提高一倍
实际一端是一个ISP 用56kbps调制解调器（最大可达70kbps）

### 数字用户线（xDSL）
最流行的一个 非对称数字用户线（ADSL）
如果是电话服务 则由一个滤波器（300Hz-3400Hz）
当用户要使用ADSL技术时 就没有滤波器 大概可以支持1Mbps（距端局越近 速率越快）
xDSL的设计目标
- 服务必须基于现有的三类双绞线
- 不能影响客户原来的电话和传真业务
- 必须比56kbps快
- 服务应总是可用的 且要月租收费

使用OFDM方案（此处称为离散多音【DMT】）
1.1MHz的频谱分成256条信道 每个信道宽4312.5Hz
信道0用于简单老式电话
信道1-5空闲
剩下250个信道 1条用于上行流控制 1条用于下行流控制 其它全部用于用户数据

理论上剩下每条信道都可以用作全双工数据流 但是实际性能大大低于理论限制
所以上行与下行数据流大小由服务商决定 一般将80%-90%的带宽用于下行信道 其它用于上行信道（ADSL非对称）
还有一种可以使一些最高端的上行信道成为双向信道（增加带宽）
但要求有特殊的电路来消除回声

ADSL2+在离端局较近的地方可达到1 24Mbps
服务商日常提供的服务是256kbps 1Mbps
->2 8Mbps(高级)

技术人员在客户家中安装网络接口设备(NID)
靠近NID的是一个分离器(一个模拟滤波器)
将0-4000的模拟信号和其他数据信号分开
POTS信号->电话或传真
数据信号->ADSL调制解调器
电话公司端只需要安装一个DSLAM(数用用户线路接入复用器)和分离器

### 光纤到户
光纤接入用户家庭或相当接近用户家庭(最后的短的铜线由于长度短因而信噪比提高 带宽也大)
#### PON(无源光网络)
使用一个波长被所有用户共享 用作下行流传输
一个波长被所有用户共享用作上行流传输
PON可为20km内的用户提供高数据速率的传输
实际速率取决于PON类型
常见的有ITU定义的千兆级PON
IEEE定义的以太PON

不同用户共享端局的单根光纤需要某种协议支持
因为 端局可以以自己喜欢的方式将消息发送到不同的住户
而上行流的不同住户却不能同时发送消息 否则会冲突
解决方案是若用户要发送消息 需要向端局请求 获得端局分配的时间槽 然后在时间槽内发送

## 中继线和多路复用
电话网络中的中继线是共享经济
架设高带宽的中继线进行多路复用是合适的方法
### 语音信号数字化
一开始使用波分多路方法 但是波分多路需要模拟电路且不适合计算机处理 所以改为TDM完全数字化处理
所以需要在端局把模拟信号转为数字信号
#### 脉冲编码调制(PCM)
端局模拟信号数字化 **编码解码器**
每秒采8000个样值(125微秒采一个样) 每个样值量化为一个8比特数字
8000 * 8 = 64kbps

#### 时分多路复用
由于未能达成协议 全世界各个国家的PCM模式都不兼容

##### 北美和日本的T1载波
每125微秒产生193个比特
第一个比特是帧码 剩下24 * 8个比特传输数据
- 信道相关信令
在6个帧中偷出几个最低位发送控制信息
- 公共信道信令
新版本用纯信道来传输控制数据
控制信令带外处理

##### E1载波
125微秒的帧中封装32个8比特数据
32个信道中30个用于传输信息 2个用作指令
每四个帧一组 共64个比特 一半用于信令 另一半用于帧同步或各个国家保留使用

##### 时分多路复用T载波
美国
4T1 -> T2
7T2 -> T3
6T3 -> T4
从低位到高位叉开复用

各个标准关于成帧方法都不同

#### SONET/SDH
SONET是光纤标准
主要目标
- 定义公共的波长 时序 帧结构等
- 定义统一美国 欧洲 日本的数字系统的方法\
- 提供一种方法来复用多条数字信道
- 必须支持 操作 管理 维护
##### 早期SONET
传统的时分复用
光纤的全部带宽分配给一条信道 再在信道上划分时间槽构成子信道
这样SONET就是一个同步系统 要求发送方和接收方都绑定到一个公共时钟上 精度达到1e-9
基本SONET帧是每隔125微秒发送810个字节的数据块
由于SONET是同步系统所以无论是否有用都要发

每一帧是9 * 90的矩形(每个块是一个字节)
前三列用于传输系统管理信息
剩余列:
前三行包含段开销
后六行包含线路开销
每一帧的前两个字节有一个固定的模式串,接收方搜索这种模式串就可以定位帧的开始
由于每一帧是多个用户复用生成的 所以每个用户不能在有效载荷中插入这种模式串

承载用户数据的 同步有效载荷包(SPE)
可以从任何一个地方开始

##### 波分多路复用(光纤WDM)
由于衍射光栅的光纤系统是完全无源的 因此可靠性极高
密集波分多路复用 2.56Tbps
全光放大器 每隔1000km重新生成整个信号 无需多次光电转换

## 交换
电路交换和数据包交换
### 电路交换
接线员插线 -> 自动接线
电路交换的特点是发送数据之前要建立一条端到端的路径
建立路径可能需要很长时间
一旦完成连接建立 唯一延迟是电磁信号的传播时间
一旦接通不会有拥塞的危险
### 包交换
包可以走不同路径
到达顺序可能混乱
对数据包的大小规定严格的上限
确保没有用户可以长时间霸占任何传输线路
可能产生排队延迟或拥塞
不会浪费资源
电路交换 按距离和时间收费
ISP收月租费
而骨干网运营商按照流量大小收费
比较见P128








